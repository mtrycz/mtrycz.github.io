<!doctype html>
<html>
<head>
  <meta charset="utf8">
  <title>Online SQL interpreter for Pokemon GO Counter analysis</title>
  <link rel="stylesheet" href="codemirror/lib/codemirror.css">
  <link rel="stylesheet" href="demo.css">
  <script src="codemirror/lib/codemirror.js"></script>
  <script src="../js/sql.js"></script>

</head>
<body>

	<h1>Online SQL interpreter</h1>
	
	Based on http://kripken.github.io/sql.js/GUI
	
	<p>You first need to load the Database file with the 'Load' button. This will take a while.
	<p>If you want to play around, you can use this, but your best bet would be downloading the db file (https://mtrycz.github.io/pkgocounters/dbbrowser/mtrycz.db) and loading it in a desktop application (eg http://sqlitebrowser.org/)
	<p>Loading will take some time without feedback. be patient.

<main>
    <label for='commands'>Enter some SQL</label>
    <br>

    <textarea id="commands">select attackername, attackerfastmove, attackerspecialmove, defendername, defenderfastmove, defenderspecialmove ,hpleftpercent
from dpscounters
where attackername ="Pidgeot" and defendername = "Lapras"
order by hpleftpercent desc
    </textarea>

<button id="load" class="button">Load</button>
<button id="execute" class="button">Execute</button>
<button id='savedb'  class="button">Save the db</button>
<label class="button">Load an SQLite database file: <input type='file' id='dbfile' ></label>

<div id="error" class="error"></div>

<pre id="output">Results will be displayed here</pre>
</main>

<script src="codemirror/mode/sql/sql.js"></script>

<footer>
sql.js
Original work by kripken (<a href='https://github.com/kripken/sql.js'>sql.js</a>).
C to Javascript compiler by kripken (<a href='https://github.com/kripken/emscripten'>emscripten</a>).
Project now maintained by <a href='https://github.com/lovasoa'>lovasoa</a>
</footer>

<script type="text/javascript" src="gui.js"></script>
<script type="text/javascript">
var execBtn = document.getElementById("load");

var loadDb = function() {
	var xhr = new XMLHttpRequest();
	xhr.open('GET', '/pkgocounters/dbbrowser/mtrycz.db', true);
	xhr.responseType = 'arraybuffer';
	
	xhr.onload = function(e) {
	  var uInt8Array = new Uint8Array(this.response);
	  // var db = new SQL.Database(uInt8Array);
	  worker.postMessage({
	    id:1,
	    action:'open',
	    buffer:uInt8Array, /*Optional. An ArrayBuffer representing an SQLite Database file*/
	})
	  // var contents = db.exec("SELECT * FROM my_table");
	  // contents is now [{columns:['col1','col2',...], values:[[first row], [second row], ...]}]
	};
	xhr.send();
}

execBtn.addEventListener("click", loadDb, true);


</script>

</body>
</html>
